---
- name: create directory
  file:
    path: /opt/guacamole
    state: directory
    mode: '0755'
    owner: '{{ansible_user}}'
  become: true

- name: Download src
  include_tasks: "{{server_version}}/download"

- name: Configure
  command: '{{server_src}}/configure {{config_args}}'
  args:
    chdir: '{{server_src}}'
    creates: '{{server_src}}/config.log'

- name: Build
  command: make
  args:
    chdir: '{{server_src}}'
    creates: '{{server_src}}/src/guacd/guacd'

- name: Install
  script: build.sh
  args:
    chdir: '{{server_src}}'
    creates: /usr/local/sbin/guacd
  become: true

# https://guacamole.apache.org/doc/gug/installing-guacamole.html
